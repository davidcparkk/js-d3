<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Kiva 2017 Crowdsourcing Data Visualization</title>
	<script src="./dist/main.js"></script>
	
	<script src="http://d3js.org/d3.v4.min.js"></script>
	<script src="http://d3js.org/queue.v1.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<style>svg{width:100%;height:500px;margin:0px auto;}</style>
	<script src="./src/data/2017-kiva-sample.json"></script>
	<style>
		body{
			margin: 0px;
			font-family:Arial, Helvetica, sans-serif;
			overflow:hidden;
		}
		h1,h2{
			position: absolute;
			font-weight: 100;
			font-size: 1.5em;
			left: 10px;
		}
		h2 {
			top: 30px;
			font-size: 1.2em;
		}
		.sphere{
			fill: #5c5cad;
		}
		.country {
			fill: #ffe596;
			stroke: black;
			stroke-opacity: 0.2;
		}
		.incident{
			fill: steelblue;
		}
		.hover {
			fill: yellow;
		}
		
	</style>

</head>
<body>
		<h1>2017 Kiva Loans Matched</h1>
    <h2></h2>
		<script>
			const svg = d3.select("body").append("svg");
			const pathGenerator = d3.geoPath().projection(d3.geoNaturalEarth1());
			

			d3.queue()
				.defer(d3.json, "https://unpkg.com/world-atlas@1/world/110m.json")
				.await(makeMap)

			function makeMap(error,data) {
				if (error) {
					console.log("*** ERROR LOADING FILES: " + error + " ***");
					throw error	
				}
				svg.append('path')
				.attr('class', 'sphere')
				.attr('d', pathGenerator({type: 'Sphere'}));

				svg.selectAll("path")
					.data(topojson.feature(data,data.objects.countries).features)
					.enter().append("path")
					.attr('class','country')
					.attr("d", pathGenerator)

				const loans = svg.append('g');
				loans.selectAll('path')
				.data(kiva_json.features)
				.enter()
				.append('path')
				.attr('fill','#900')
				.attr('stroke', '#999')
				.attr('d', pathGenerator)
				.attr( 'class', 'incident')
				.on("mouseover", function(d){
					d3.select("h2").text(d.properties.sector);
					d3.select(this).attr('class', 'incident hover');
				})
				.on("mouseout", function(d){
					d3.select("h2").text("");
					d3.select(this).attr("class", "incident");
				});
			}


			
		</script>
</body>
</html>